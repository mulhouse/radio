{"version":3,"file":"reset-password-DfLKSAfR.js","names":["useMutation","Link","useNavigate","useSearch","z","AuthCard","AuthForm","AuthField","resetPasswordFn","useServerFn","useForm","zodResolver","useState","Alert","AlertDescription","CheckCircle2","AlertCircle","Route","resetPasswordSchema","object","password","string","min","confirmPassword","refine","data","message","path","ResetPasswordPage","search","from","navigate","isSuccess","setIsSuccess","resetPassword","form","resolver","defaultValues","resetPasswordMutation","mutationFn","infer","userId","secret","Error","onSuccess","reset","setTimeout","to","onError","error","status","console","setError","mutate","isPending","control","component"],"sources":["../../../src/routes/_auth/reset-password.tsx?tsr-split=component"],"sourcesContent":["import { useMutation } from '@tanstack/react-query'\nimport {\n  createFileRoute,\n  Link,\n  useNavigate,\n  useSearch,\n} from '@tanstack/react-router'\nimport { z } from 'zod'\nimport { AuthCard } from '@/components/auth/auth-card'\nimport { AuthForm } from '@/components/auth/auth-form'\nimport { AuthField } from '@/components/auth/auth-field'\nimport { resetPasswordFn } from '@/server/functions/auth'\nimport { useServerFn } from '@tanstack/react-start'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport { useState } from 'react'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { CheckCircle2, AlertCircle } from 'lucide-react'\n\nconst searchSchema = z.object({\n  userId: z.string().optional(),\n  secret: z.string().optional(),\n})\n\nexport const Route = createFileRoute('/_auth/reset-password')({\n  component: ResetPasswordPage,\n  validateSearch: searchSchema,\n})\n\nconst resetPasswordSchema = z\n  .object({\n    password: z.string().min(8, 'Password must be at least 8 characters'),\n    confirmPassword: z\n      .string()\n      .min(8, 'Password must be at least 8 characters'),\n  })\n  .refine((data) => data.password === data.confirmPassword, {\n    message: \"Passwords don't match\",\n    path: ['confirmPassword'],\n  })\n\nfunction ResetPasswordPage() {\n  const search = useSearch({ from: '/_auth/reset-password' })\n  const navigate = useNavigate()\n  const [isSuccess, setIsSuccess] = useState(false)\n  const resetPassword = useServerFn(resetPasswordFn)\n  const form = useForm({\n    resolver: zodResolver(resetPasswordSchema),\n    defaultValues: {\n      password: '',\n      confirmPassword: '',\n    },\n  })\n\n  const resetPasswordMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof resetPasswordSchema>) => {\n      if (!search.userId || !search.secret) {\n        throw new Error('Invalid recovery link')\n      }\n\n      await resetPassword({\n        data: {\n          userId: search.userId,\n          secret: search.secret,\n          password: data.password,\n          confirmPassword: data.confirmPassword,\n        },\n      })\n    },\n    onSuccess: () => {\n      setIsSuccess(true)\n      form.reset()\n      // Redirect to sign in after 3 seconds\n      setTimeout(() => {\n        void navigate({ to: '/sign-in' })\n      }, 3000)\n    },\n    onError: (error: { status: number; message: string }) => {\n      console.error('Reset password error:', error)\n      form.setError('root', {\n        message: error.message || 'Failed to reset password',\n      })\n    },\n  })\n\n  if (!search.userId || !search.secret) {\n    return (\n      <AuthCard\n        title=\"Invalid recovery link\"\n        description=\"The password recovery link is invalid or has expired\"\n      >\n        <Alert className=\"border-red-500 bg-red-50 dark:bg-red-950\">\n          <AlertCircle className=\"h-4 w-4 text-red-600 dark:text-red-400\" />\n          <AlertDescription className=\"text-red-800 dark:text-red-200\">\n            This recovery link is invalid or has expired. Please request a new\n            password recovery link.\n          </AlertDescription>\n        </Alert>\n\n        <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n          <div className=\"inline-block\">\n            <Link\n              to=\"/forgot-password\"\n              className=\"font-medium text-primary underline-offset-4 hover:underline\"\n            >\n              Request new recovery link\n            </Link>\n          </div>\n        </div>\n      </AuthCard>\n    )\n  }\n\n  if (isSuccess) {\n    return (\n      <AuthCard\n        title=\"Password reset successful\"\n        description=\"Your password has been updated\"\n      >\n        <Alert className=\"border-green-500 bg-green-50 dark:bg-green-950\">\n          <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n          <AlertDescription className=\"text-green-800 dark:text-green-200\">\n            Your password has been reset successfully. You'll be redirected to\n            the sign in page shortly.\n          </AlertDescription>\n        </Alert>\n\n        <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n          <div className=\"inline-block\">\n            <Link\n              to=\"/sign-in\"\n              className=\"font-medium text-primary underline-offset-4 hover:underline\"\n            >\n              Sign in now\n            </Link>\n          </div>\n        </div>\n      </AuthCard>\n    )\n  }\n\n  return (\n    <AuthCard\n      title=\"Reset password\"\n      description=\"Enter your new password below\"\n    >\n      <AuthForm\n        schema={resetPasswordSchema}\n        defaultValues={{\n          password: '',\n          confirmPassword: '',\n        }}\n        onSubmit={(data) => resetPasswordMutation.mutate(data)}\n        submitText=\"Reset password\"\n        loadingText=\"Resetting...\"\n        isLoading={resetPasswordMutation.isPending}\n        form={form}\n      >\n        {(form) => (\n          <>\n            <AuthField\n              control={form.control}\n              name=\"password\"\n              label=\"New Password\"\n              placeholder=\"Enter your new password\"\n              type=\"password\"\n            />\n\n            <AuthField\n              control={form.control}\n              name=\"confirmPassword\"\n              label=\"Confirm Password\"\n              placeholder=\"Confirm your new password\"\n              type=\"password\"\n            />\n          </>\n        )}\n      </AuthForm>\n\n      <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n        <div className=\"inline-block\">Remember your password? </div>\n        <div className=\"inline-block\">\n          <Link\n            to=\"/sign-in\"\n            className=\"font-medium text-primary underline-offset-4 hover:underline\"\n          >\n            Sign in\n          </Link>\n        </div>\n      </div>\n    </AuthCard>\n  )\n}\n"],"mappings":"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"}