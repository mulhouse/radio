import{a as e,b as t,i as n,n as r,o as i,r as a,s as o,t as s}from"./index-BM_RBz7Q.js";import{c,l,s as u,t as d}from"./zod-DsoXa-XD.js";var f=r(`src_server_functions_auth_ts--getAppwriteSessionFn_createServerFn_handler`,(e,t)=>E.__executeServer(e,t)),p=d.object({id:d.string(),secret:d.string(),expires:d.string().optional()}),m=r(`src_server_functions_auth_ts--setAppwriteSessionCookiesFn_createServerFn_handler`,(e,t)=>D.__executeServer(e,t)),h=d.object({email:d.email(`Please enter a valid email address`),password:d.string().min(8,`Password must be at least 8 characters`),redirect:d.string().optional()}),g=r(`src_server_functions_auth_ts--signUpFn_createServerFn_handler`,(e,t)=>O.__executeServer(e,t)),_=r(`src_server_functions_auth_ts--signInFn_createServerFn_handler`,(e,t)=>k.__executeServer(e,t)),v=r(`src_server_functions_auth_ts--signOutFn_createServerFn_handler`,(e,t)=>A.__executeServer(e,t)),y=r(`src_server_functions_auth_ts--authMiddleware_createServerFn_handler`,(e,t)=>j.__executeServer(e,t)),b=()=>{a(`appwrite-session-secret`),a(`appwrite-session-id`),a(`a_session_${{}.APPWRITE_PROJECT_ID}`)},x=r(`src_server_functions_auth_ts--getCurrentUser_createServerFn_handler`,(e,t)=>M.__executeServer(e,t)),S=d.object({email:d.string().email(`Please enter a valid email address`)}),C=r(`src_server_functions_auth_ts--forgotPasswordFn_createServerFn_handler`,(e,t)=>N.__executeServer(e,t)),w=d.object({userId:d.string().min(1,`User ID is required`),secret:d.string().min(1,`Secret is required`),password:d.string().min(8,`Password must be at least 8 characters`),confirmPassword:d.string().min(8,`Password must be at least 8 characters`)}),T=r(`src_server_functions_auth_ts--resetPasswordFn_createServerFn_handler`,(e,t)=>P.__executeServer(e,t)),E=s({method:`GET`}).handler(f,async()=>n(`appwrite-session-secret`)||null),D=s({method:`POST`}).inputValidator(p).handler(m,async({data:e})=>{let{id:t,secret:n,expires:r}=e,a=720*60*60;if(r){let e=Math.floor(new Date(r).getTime()/1e3),t=Math.floor(Date.now()/1e3);a=Math.max(0,e-t)}i(`appwrite-session-secret`,n,{httpOnly:!0,secure:!0,sameSite:`none`,maxAge:a,path:`/`}),i(`appwrite-session-id`,t,{httpOnly:!0,secure:!0,sameSite:`none`,maxAge:a,path:`/`})}),O=s({method:`POST`}).inputValidator(h).handler(g,async({data:e})=>{let{email:n,password:r,redirect:i}=e,{account:a}=u();try{await a.create({userId:l.unique(),email:n,password:r});let e=await a.createEmailPasswordSession({email:n,password:r});await D({data:{id:e.$id,secret:e.secret,expires:e.expire||void 0}})}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}throw t(i?{to:i}:{to:`/`})}),k=s({method:`POST`}).inputValidator(h).handler(_,async({data:e})=>{let{email:n,password:r,redirect:i}=e;try{let{account:e}=u(),t=await e.createEmailPasswordSession({email:n,password:r});await D({data:{id:t.$id,secret:t.secret,expires:t.expire||void 0}})}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}throw t(i?{to:i}:{to:`/`})}),A=s({method:`GET`}).handler(v,async()=>{try{let e=await E();e&&await(await c(e)).account.deleteSession({sessionId:`current`})}catch(e){console.error(`Error deleting session:`,e)}finally{b()}}),j=s({method:`GET`}).handler(y,async()=>({currentUser:await M()})),M=s({method:`GET`}).handler(x,async()=>{let e=await E();if(!e)return null;try{return await(await c(e)).account.get()}catch(e){return e.code===401&&b(),null}}),N=s({method:`POST`}).inputValidator(S).handler(C,async({data:t})=>{let{email:n}=t,{account:r}=u();try{let t=e(`origin`);if(!t)throw Error(`Missing origin header`);let i=`${t}/reset-password`;return await r.createRecovery({email:n,url:i}),{success:!0,message:`Password recovery email sent successfully`}}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}}),P=s({method:`POST`}).inputValidator(w).handler(T,async({data:e})=>{let{userId:t,secret:n,password:r,confirmPassword:i}=e;if(r!==i)throw o(400),{message:`Passwords do not match`,status:400};try{let{account:e}=u();return await e.updateRecovery({userId:t,secret:n,password:r}),{success:!0,message:`Password reset successfully`}}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}});export{y as authMiddleware_createServerFn_handler,C as forgotPasswordFn_createServerFn_handler,f as getAppwriteSessionFn_createServerFn_handler,x as getCurrentUser_createServerFn_handler,T as resetPasswordFn_createServerFn_handler,m as setAppwriteSessionCookiesFn_createServerFn_handler,_ as signInFn_createServerFn_handler,v as signOutFn_createServerFn_handler,g as signUpFn_createServerFn_handler};