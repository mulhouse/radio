import{a as e,b as t,i as n,n as r,o as i,r as a,s as o,t as s}from"./index-BM_RBz7Q.js";import{c,l,s as u,t as d}from"./zod-DsoXa-XD.js";var f=r(`src_server_functions_auth_ts--getAppwriteSessionFn_createServerFn_handler`,(e,t)=>p.__executeServer(e,t)),p=s({method:`GET`}).handler(f,async()=>n(`appwrite-session-secret`)||null),m=d.object({id:d.string(),secret:d.string(),expires:d.string().optional()}),h=r(`src_server_functions_auth_ts--setAppwriteSessionCookiesFn_createServerFn_handler`,(e,t)=>g.__executeServer(e,t)),g=s({method:`POST`}).inputValidator(m).handler(h,async({data:e})=>{let{id:t,secret:n,expires:r}=e,a=720*60*60;if(r){let e=Math.floor(new Date(r).getTime()/1e3),t=Math.floor(Date.now()/1e3);a=Math.max(0,e-t)}i(`appwrite-session-secret`,n,{httpOnly:!0,secure:!0,sameSite:`none`,maxAge:a,path:`/`}),i(`appwrite-session-id`,t,{httpOnly:!0,secure:!0,sameSite:`none`,maxAge:a,path:`/`})}),_=d.object({email:d.email(`Please enter a valid email address`),password:d.string().min(8,`Password must be at least 8 characters`),redirect:d.string().optional()}),v=r(`src_server_functions_auth_ts--signUpFn_createServerFn_handler`,(e,t)=>y.__executeServer(e,t)),y=s({method:`POST`}).inputValidator(_).handler(v,async({data:e})=>{let{email:n,password:r,redirect:i}=e,{account:a}=u();try{await a.create({userId:l.unique(),email:n,password:r});let e=await a.createEmailPasswordSession({email:n,password:r});await g({data:{id:e.$id,secret:e.secret,expires:e.expire||void 0}})}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}throw t(i?{to:i}:{to:`/`})}),b=r(`src_server_functions_auth_ts--signInFn_createServerFn_handler`,(e,t)=>x.__executeServer(e,t)),x=s({method:`POST`}).inputValidator(_).handler(b,async({data:e})=>{let{email:n,password:r,redirect:i}=e;try{let{account:e}=u(),t=await e.createEmailPasswordSession({email:n,password:r});await g({data:{id:t.$id,secret:t.secret,expires:t.expire||void 0}})}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}throw t(i?{to:i}:{to:`/`})}),S=r(`src_server_functions_auth_ts--signOutFn_createServerFn_handler`,(e,t)=>C.__executeServer(e,t)),C=s({method:`GET`}).handler(S,async()=>{try{let e=await p();e&&await(await c(e)).account.deleteSession({sessionId:`current`})}catch(e){console.error(`Error deleting session:`,e)}finally{E()}}),w=r(`src_server_functions_auth_ts--authMiddleware_createServerFn_handler`,(e,t)=>T.__executeServer(e,t)),T=s({method:`GET`}).handler(w,async()=>({currentUser:await O()})),E=()=>{a(`appwrite-session-secret`),a(`appwrite-session-id`),a(`a_session_${{}.APPWRITE_PROJECT_ID}`)},D=r(`src_server_functions_auth_ts--getCurrentUser_createServerFn_handler`,(e,t)=>O.__executeServer(e,t)),O=s({method:`GET`}).handler(D,async()=>{let e=await p();if(!e)return null;try{return await(await c(e)).account.get()}catch(e){return e.code===401&&E(),null}}),k=d.object({email:d.string().email(`Please enter a valid email address`)}),A=r(`src_server_functions_auth_ts--forgotPasswordFn_createServerFn_handler`,(e,t)=>j.__executeServer(e,t)),j=s({method:`POST`}).inputValidator(k).handler(A,async({data:t})=>{let{email:n}=t,{account:r}=u();try{let t=e(`origin`);if(!t)throw Error(`Missing origin header`);let i=`${t}/reset-password`;return await r.createRecovery({email:n,url:i}),{success:!0,message:`Password recovery email sent successfully`}}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}}),M=d.object({userId:d.string().min(1,`User ID is required`),secret:d.string().min(1,`Secret is required`),password:d.string().min(8,`Password must be at least 8 characters`),confirmPassword:d.string().min(8,`Password must be at least 8 characters`)}),N=r(`src_server_functions_auth_ts--resetPasswordFn_createServerFn_handler`,(e,t)=>P.__executeServer(e,t)),P=s({method:`POST`}).inputValidator(M).handler(N,async({data:e})=>{let{userId:t,secret:n,password:r,confirmPassword:i}=e;if(r!==i)throw o(400),{message:`Passwords do not match`,status:400};try{let{account:e}=u();return await e.updateRecovery({userId:t,secret:n,password:r}),{success:!0,message:`Password reset successfully`}}catch(e){let t=e;throw o(t.code),{message:t.message,status:t.code}}});export{x as a,P as i,j as n,C as o,O as r,y as s,T as t};