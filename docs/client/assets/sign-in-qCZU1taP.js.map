{"version":3,"file":"sign-in-qCZU1taP.js","names":["useMutation","Link","useNavigate","useRouter","useSearch","z","AuthCard","AuthForm","AuthField","signInFn","useServerFn","useForm","zodResolver","Route","signInSchema","object","email","string","password","min","SignInPage","search","from","navigate","router","signIn","form","resolver","defaultValues","signInMutation","mutationFn","data","infer","redirect","onSuccess","invalidate","to","onError","error","status","message","includes","console","setError","mutate","isPending","control","undefined","component"],"sources":["../../../src/routes/_auth/sign-in.tsx?tsr-split=component"],"sourcesContent":["/**\n * @imagine-readonly\n */\n\nimport { useMutation } from '@tanstack/react-query'\nimport {\n  createFileRoute,\n  Link,\n  useNavigate,\n  useRouter,\n  useSearch,\n} from '@tanstack/react-router'\nimport { z } from 'zod'\nimport { AuthCard } from '@/components/auth/auth-card'\nimport { AuthForm } from '@/components/auth/auth-form'\nimport { AuthField } from '@/components/auth/auth-field'\nimport { signInFn } from '@/server/functions/auth'\nimport { useServerFn } from '@tanstack/react-start'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\n\nconst searchSchema = z.object({\n  redirect: z.string().optional(),\n})\n\nexport const Route = createFileRoute('/_auth/sign-in')({\n  component: SignInPage,\n  validateSearch: searchSchema,\n})\n\nconst signInSchema = z.object({\n  email: z.string().email('Please enter a valid email address'),\n  password: z.string().min(1, 'Password is required'),\n})\n\nfunction SignInPage() {\n  const search = useSearch({ from: '/_auth/sign-in' })\n  const navigate = useNavigate()\n  const router = useRouter()\n  const signIn = useServerFn(signInFn)\n  const form = useForm({\n    resolver: zodResolver(signInSchema),\n    defaultValues: {\n      email: '',\n      password: '',\n    },\n  })\n\n  const signInMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof signInSchema>) => {\n      await signIn({\n        data: { ...data, redirect: search.redirect },\n      })\n    },\n    onSuccess: async () => {\n      // Invalidate router to refresh auth state\n      await router.invalidate()\n      // Navigate to the redirect destination if provided\n      if (search.redirect) {\n        await navigate({ to: search.redirect })\n      }\n    },\n\n    onError: async (error: {\n      status: number\n      redirect: boolean\n      message: string\n    }) => {\n      // Check if it's a redirect error (TanStack Start throws redirects as errors)\n      if (\n        error?.status === 302 ||\n        error?.redirect ||\n        error?.message?.includes('redirect')\n      ) {\n        // Invalidate router to refresh auth state\n        await router.invalidate()\n        // Navigate to the redirect destination if provided\n        if (search.redirect) {\n          await navigate({ to: search.redirect })\n        }\n        return\n      }\n      console.error('Sign in error:', error)\n      form.setError('root', { message: error.message || 'Failed to sign in' })\n    },\n  })\n\n  return (\n    <AuthCard\n      title=\"Sign in\"\n      description=\"Enter your email and password to access your account\"\n    >\n      <AuthForm\n        schema={signInSchema}\n        defaultValues={{\n          email: '',\n          password: '',\n        }}\n        onSubmit={(data) => signInMutation.mutate(data)}\n        submitText=\"Sign in\"\n        loadingText=\"Signing in...\"\n        isLoading={signInMutation.isPending}\n        form={form}\n      >\n        {(form) => (\n          <>\n            <AuthField\n              control={form.control}\n              name=\"email\"\n              label=\"Email\"\n              placeholder=\"john@doe.com\"\n              type=\"email\"\n            />\n\n            <div className=\"space-y-2\">\n              <AuthField\n                control={form.control}\n                name=\"password\"\n                label=\"Password\"\n                placeholder=\"Enter your password\"\n                type=\"password\"\n              />\n              <div className=\"text-right\">\n                <Link\n                  to=\"/forgot-password\"\n                  className=\"text-xs md:text-sm text-muted-foreground hover:text-primary underline-offset-4 hover:underline\"\n                >\n                  Forgot password?\n                </Link>\n              </div>\n            </div>\n          </>\n        )}\n      </AuthForm>\n\n      <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n        <div className=\"inline-block\">Don't have an account? </div>\n        <div className=\"inline-block\">\n          <Link\n            to=\"/sign-up\"\n            search={search.redirect ? { redirect: search.redirect } : undefined}\n            className=\"font-medium text-primary underline-offset-4 hover:underline\"\n          >\n            Sign up\n          </Link>\n        </div>\n      </div>\n    </AuthCard>\n  )\n}\n"],"mappings":"kQA8BMc,EAAeT,EAAS,CAC5BW,MAAOX,GAAU,CAACW,MAAM,qCAAqC,CAC7DE,SAAUb,GAAU,CAACc,IAAI,EAAG,uBAAsB,CACnD,CAAC,CAEF,SAASC,GAAa,CACpB,IAAMC,EAASjB,EAAU,CAAEkB,KAAM,iBAAkB,CAAC,CAC9CC,EAAWrB,GAAa,CACxBsB,EAASrB,GAAW,CACpBsB,EAASf,EAAYD,EAAS,CAC9BiB,EAAOf,EAAQ,CACnBgB,SAAUf,EAAYE,EAAa,CACnCc,cAAe,CACbZ,MAAO,GACPE,SAAU,GACZ,CACD,CAAC,CAEIW,EAAiB7B,EAAY,CACjC8B,WAAY,KAAOC,IAAuC,CACxD,MAAMN,EAAO,CACXM,KAAM,CAAE,GAAGA,EAAME,SAAUZ,EAAOY,SAAS,CAC5C,CAAC,EAEJC,UAAW,SAAY,CAErB,MAAMV,EAAOW,YAAY,CAErBd,EAAOY,UACT,MAAMV,EAAS,CAAEa,GAAIf,EAAOY,SAAU,CAAC,EAI3CI,QAAS,KAAOC,IAIV,CAEJ,GACEA,GAAOC,SAAW,KAClBD,GAAOL,UACPK,GAAOE,SAASC,SAAS,WAAW,CACpC,CAEA,MAAMjB,EAAOW,YAAY,CAErBd,EAAOY,UACT,MAAMV,EAAS,CAAEa,GAAIf,EAAOY,SAAU,CAAC,CAEzC,OAEFS,QAAQJ,MAAM,iBAAkBA,EAAM,CACtCZ,EAAKiB,SAAS,OAAQ,CAAEH,QAASF,EAAME,SAAW,oBAAqB,CAAC,EAE3E,CAAC,CAEF,OACE,EAAA,EAAA,MAAC,EAAA,CACC,MAAM,UACN,YAAY,kEAEZ,EAAA,EAAA,KAAC,EAAA,CACC,OAAQ1B,EACR,cAAe,CACbE,MAAO,GACPE,SAAU,GACX,CACD,SAAWa,GAASF,EAAee,OAAOb,EAAK,CAC/C,WAAW,UACX,YAAY,gBACZ,UAAWF,EAAegB,UACpBnB,gBAEJA,IACA,EAAA,EAAA,MAAA,EAAA,SAAA,CAAA,SAAA,EACE,EAAA,EAAA,KAAC,EAAA,CACC,QAASA,EAAKoB,QACd,KAAK,QACL,MAAM,QACN,YAAY,eACZ,KAAK,SAAO,EAGd,EAAA,EAAA,MAAC,MAAA,CAAI,UAAU,uBACb,EAAA,EAAA,KAAC,EAAA,CACC,QAASpB,EAAKoB,QACd,KAAK,WACL,MAAM,WACN,YAAY,sBACZ,KAAK,YAAU,EAEjB,EAAA,EAAA,KAAC,MAAA,CAAI,UAAU,uBACb,EAAA,EAAA,KAAC,EAAA,CACC,GAAG,mBACH,UAAU,0GAAgG,oBAGtG,EACH,CAAA,EACF,CAAA,CAAA,CAER,EACO,EAEV,EAAA,EAAA,MAAC,MAAA,CAAI,UAAU,sEACb,EAAA,EAAA,KAAC,MAAA,CAAI,UAAU,wBAAe,2BAA4B,EAC1D,EAAA,EAAA,KAAC,MAAA,CAAI,UAAU,yBACb,EAAA,EAAA,KAAC,EAAA,CACC,GAAG,WACH,OAAQzB,EAAOY,SAAW,CAAEA,SAAUZ,EAAOY,SAAU,CAAGc,IAAAA,GAC1D,UAAU,uEAA6D,WAGnE,EACH,CAAA,EACF,CAAA,EACI"}