{"version":3,"file":"sign-in-CqGtS4Kf.js","names":["useMutation","Link","useNavigate","useRouter","useSearch","z","AuthCard","AuthForm","AuthField","signInFn","useServerFn","useForm","zodResolver","Route","signInSchema","object","email","string","password","min","SignInPage","search","from","navigate","router","signIn","form","resolver","defaultValues","signInMutation","mutationFn","data","infer","redirect","onSuccess","invalidate","to","onError","error","status","message","includes","console","setError","mutate","isPending","control","undefined","component"],"sources":["../../../src/routes/_auth/sign-in.tsx?tsr-split=component"],"sourcesContent":["/**\n * @imagine-readonly\n */\n\nimport { useMutation } from '@tanstack/react-query'\nimport {\n  createFileRoute,\n  Link,\n  useNavigate,\n  useRouter,\n  useSearch,\n} from '@tanstack/react-router'\nimport { z } from 'zod'\nimport { AuthCard } from '@/components/auth/auth-card'\nimport { AuthForm } from '@/components/auth/auth-form'\nimport { AuthField } from '@/components/auth/auth-field'\nimport { signInFn } from '@/server/functions/auth'\nimport { useServerFn } from '@tanstack/react-start'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\n\nconst searchSchema = z.object({\n  redirect: z.string().optional(),\n})\n\nexport const Route = createFileRoute('/_auth/sign-in')({\n  component: SignInPage,\n  validateSearch: searchSchema,\n})\n\nconst signInSchema = z.object({\n  email: z.string().email('Please enter a valid email address'),\n  password: z.string().min(1, 'Password is required'),\n})\n\nfunction SignInPage() {\n  const search = useSearch({ from: '/_auth/sign-in' })\n  const navigate = useNavigate()\n  const router = useRouter()\n  const signIn = useServerFn(signInFn)\n  const form = useForm({\n    resolver: zodResolver(signInSchema),\n    defaultValues: {\n      email: '',\n      password: '',\n    },\n  })\n\n  const signInMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof signInSchema>) => {\n      await signIn({\n        data: { ...data, redirect: search.redirect },\n      })\n    },\n    onSuccess: async () => {\n      // Invalidate router to refresh auth state\n      await router.invalidate()\n      // Navigate to the redirect destination if provided\n      if (search.redirect) {\n        await navigate({ to: search.redirect })\n      }\n    },\n\n    onError: async (error: {\n      status: number\n      redirect: boolean\n      message: string\n    }) => {\n      // Check if it's a redirect error (TanStack Start throws redirects as errors)\n      if (\n        error?.status === 302 ||\n        error?.redirect ||\n        error?.message?.includes('redirect')\n      ) {\n        // Invalidate router to refresh auth state\n        await router.invalidate()\n        // Navigate to the redirect destination if provided\n        if (search.redirect) {\n          await navigate({ to: search.redirect })\n        }\n        return\n      }\n      console.error('Sign in error:', error)\n      form.setError('root', { message: error.message || 'Failed to sign in' })\n    },\n  })\n\n  return (\n    <AuthCard\n      title=\"Sign in\"\n      description=\"Enter your email and password to access your account\"\n    >\n      <AuthForm\n        schema={signInSchema}\n        defaultValues={{\n          email: '',\n          password: '',\n        }}\n        onSubmit={(data) => signInMutation.mutate(data)}\n        submitText=\"Sign in\"\n        loadingText=\"Signing in...\"\n        isLoading={signInMutation.isPending}\n        form={form}\n      >\n        {(form) => (\n          <>\n            <AuthField\n              control={form.control}\n              name=\"email\"\n              label=\"Email\"\n              placeholder=\"john@doe.com\"\n              type=\"email\"\n            />\n\n            <div className=\"space-y-2\">\n              <AuthField\n                control={form.control}\n                name=\"password\"\n                label=\"Password\"\n                placeholder=\"Enter your password\"\n                type=\"password\"\n              />\n              <div className=\"text-right\">\n                <Link\n                  to=\"/forgot-password\"\n                  className=\"text-xs md:text-sm text-muted-foreground hover:text-primary underline-offset-4 hover:underline\"\n                >\n                  Forgot password?\n                </Link>\n              </div>\n            </div>\n          </>\n        )}\n      </AuthForm>\n\n      <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n        <div className=\"inline-block\">Don't have an account? </div>\n        <div className=\"inline-block\">\n          <Link\n            to=\"/sign-up\"\n            search={search.redirect ? { redirect: search.redirect } : undefined}\n            className=\"font-medium text-primary underline-offset-4 hover:underline\"\n          >\n            Sign up\n          </Link>\n        </div>\n      </div>\n    </AuthCard>\n  )\n}\n"],"mappings":";;;;;;;;;;;AA8BA,IAAMc,eAAeT,EAAEU,OAAO;CAC5BC,OAAOX,EAAEY,QAAQ,CAACD,MAAM,qCAAqC;CAC7DE,UAAUb,EAAEY,QAAQ,CAACE,IAAI,GAAG,uBAAsB;CACnD,CAAC;AAEF,SAASC,aAAa;CACpB,MAAMC,SAASjB,UAAU,EAAEkB,MAAM,kBAAkB,CAAC;CACpD,MAAMC,WAAWrB,aAAa;CAC9B,MAAMsB,SAASrB,WAAW;CAC1B,MAAMsB,SAASf,YAAYD,SAAS;CACpC,MAAMiB,OAAOf,QAAQ;EACnBgB,UAAUf,YAAYE,aAAa;EACnCc,eAAe;GACbZ,OAAO;GACPE,UAAU;GACZ;EACD,CAAC;CAEF,MAAMW,iBAAiB7B,YAAY;EACjC8B,YAAY,OAAOC,SAAuC;AACxD,SAAMN,OAAO,EACXM,MAAM;IAAE,GAAGA;IAAME,UAAUZ,OAAOY;IAAS,EAC5C,CAAC;;EAEJC,WAAW,YAAY;AAErB,SAAMV,OAAOW,YAAY;AAEzB,OAAId,OAAOY,SACT,OAAMV,SAAS,EAAEa,IAAIf,OAAOY,UAAU,CAAC;;EAI3CI,SAAS,OAAOC,UAIV;AAEJ,OACEA,OAAOC,WAAW,OAClBD,OAAOL,YACPK,OAAOE,SAASC,SAAS,WAAW,EACpC;AAEA,UAAMjB,OAAOW,YAAY;AAEzB,QAAId,OAAOY,SACT,OAAMV,SAAS,EAAEa,IAAIf,OAAOY,UAAU,CAAC;AAEzC;;AAEFS,WAAQJ,MAAM,kBAAkBA,MAAM;AACtCZ,QAAKiB,SAAS,QAAQ,EAAEH,SAASF,MAAME,WAAW,qBAAqB,CAAC;;EAE3E,CAAC;AAEF,QACE,qBAAC,UAAA;EACC,OAAM;EACN,aAAY;aAEZ,oBAAC,UAAA;GACC,QAAQ1B;GACR,eAAe;IACbE,OAAO;IACPE,UAAU;IACX;GACD,WAAWa,SAASF,eAAee,OAAOb,KAAK;GAC/C,YAAW;GACX,aAAY;GACZ,WAAWF,eAAegB;GACpBnB;cAEJA,WACA,qBAAA,UAAA,EAAA,UAAA,CACE,oBAAC,WAAA;IACC,SAASA,OAAKoB;IACd,MAAK;IACL,OAAM;IACN,aAAY;IACZ,MAAK;KAAO,EAGd,qBAAC,OAAA;IAAI,WAAU;eACb,oBAAC,WAAA;KACC,SAASpB,OAAKoB;KACd,MAAK;KACL,OAAM;KACN,aAAY;KACZ,MAAK;MAAU,EAEjB,oBAAC,OAAA;KAAI,WAAU;eACb,oBAAC,MAAA;MACC,IAAG;MACH,WAAU;gBAAgG;OAGtG;MACH,CAAA;KACF,CAAA,EAAA,CAER;IACO,EAEV,qBAAC,OAAA;GAAI,WAAU;cACb,oBAAC,OAAA;IAAI,WAAU;cAAe;KAA4B,EAC1D,oBAAC,OAAA;IAAI,WAAU;cACb,oBAAC,MAAA;KACC,IAAG;KACH,QAAQzB,OAAOY,WAAW,EAAEA,UAAUZ,OAAOY,UAAU,GAAGc,KAAAA;KAC1D,WAAU;eAA6D;MAGnE;KACH,CAAA;IACF,CAAA;GACI"}