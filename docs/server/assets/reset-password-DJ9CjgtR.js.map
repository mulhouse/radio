{"version":3,"file":"reset-password-DJ9CjgtR.js","names":["useMutation","Link","useNavigate","useSearch","z","AuthCard","AuthForm","AuthField","resetPasswordFn","useServerFn","useForm","zodResolver","useState","Alert","AlertDescription","CheckCircle2","AlertCircle","Route","resetPasswordSchema","object","password","string","min","confirmPassword","refine","data","message","path","ResetPasswordPage","search","from","navigate","isSuccess","setIsSuccess","resetPassword","form","resolver","defaultValues","resetPasswordMutation","mutationFn","infer","userId","secret","Error","onSuccess","reset","setTimeout","to","onError","error","status","console","setError","mutate","isPending","control","component"],"sources":["../../../src/routes/_auth/reset-password.tsx?tsr-split=component"],"sourcesContent":["import { useMutation } from '@tanstack/react-query'\nimport {\n  createFileRoute,\n  Link,\n  useNavigate,\n  useSearch,\n} from '@tanstack/react-router'\nimport { z } from 'zod'\nimport { AuthCard } from '@/components/auth/auth-card'\nimport { AuthForm } from '@/components/auth/auth-form'\nimport { AuthField } from '@/components/auth/auth-field'\nimport { resetPasswordFn } from '@/server/functions/auth'\nimport { useServerFn } from '@tanstack/react-start'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport { useState } from 'react'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { CheckCircle2, AlertCircle } from 'lucide-react'\n\nconst searchSchema = z.object({\n  userId: z.string().optional(),\n  secret: z.string().optional(),\n})\n\nexport const Route = createFileRoute('/_auth/reset-password')({\n  component: ResetPasswordPage,\n  validateSearch: searchSchema,\n})\n\nconst resetPasswordSchema = z\n  .object({\n    password: z.string().min(8, 'Password must be at least 8 characters'),\n    confirmPassword: z\n      .string()\n      .min(8, 'Password must be at least 8 characters'),\n  })\n  .refine((data) => data.password === data.confirmPassword, {\n    message: \"Passwords don't match\",\n    path: ['confirmPassword'],\n  })\n\nfunction ResetPasswordPage() {\n  const search = useSearch({ from: '/_auth/reset-password' })\n  const navigate = useNavigate()\n  const [isSuccess, setIsSuccess] = useState(false)\n  const resetPassword = useServerFn(resetPasswordFn)\n  const form = useForm({\n    resolver: zodResolver(resetPasswordSchema),\n    defaultValues: {\n      password: '',\n      confirmPassword: '',\n    },\n  })\n\n  const resetPasswordMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof resetPasswordSchema>) => {\n      if (!search.userId || !search.secret) {\n        throw new Error('Invalid recovery link')\n      }\n\n      await resetPassword({\n        data: {\n          userId: search.userId,\n          secret: search.secret,\n          password: data.password,\n          confirmPassword: data.confirmPassword,\n        },\n      })\n    },\n    onSuccess: () => {\n      setIsSuccess(true)\n      form.reset()\n      // Redirect to sign in after 3 seconds\n      setTimeout(() => {\n        void navigate({ to: '/sign-in' })\n      }, 3000)\n    },\n    onError: (error: { status: number; message: string }) => {\n      console.error('Reset password error:', error)\n      form.setError('root', {\n        message: error.message || 'Failed to reset password',\n      })\n    },\n  })\n\n  if (!search.userId || !search.secret) {\n    return (\n      <AuthCard\n        title=\"Invalid recovery link\"\n        description=\"The password recovery link is invalid or has expired\"\n      >\n        <Alert className=\"border-red-500 bg-red-50 dark:bg-red-950\">\n          <AlertCircle className=\"h-4 w-4 text-red-600 dark:text-red-400\" />\n          <AlertDescription className=\"text-red-800 dark:text-red-200\">\n            This recovery link is invalid or has expired. Please request a new\n            password recovery link.\n          </AlertDescription>\n        </Alert>\n\n        <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n          <div className=\"inline-block\">\n            <Link\n              to=\"/forgot-password\"\n              className=\"font-medium text-primary underline-offset-4 hover:underline\"\n            >\n              Request new recovery link\n            </Link>\n          </div>\n        </div>\n      </AuthCard>\n    )\n  }\n\n  if (isSuccess) {\n    return (\n      <AuthCard\n        title=\"Password reset successful\"\n        description=\"Your password has been updated\"\n      >\n        <Alert className=\"border-green-500 bg-green-50 dark:bg-green-950\">\n          <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n          <AlertDescription className=\"text-green-800 dark:text-green-200\">\n            Your password has been reset successfully. You'll be redirected to\n            the sign in page shortly.\n          </AlertDescription>\n        </Alert>\n\n        <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n          <div className=\"inline-block\">\n            <Link\n              to=\"/sign-in\"\n              className=\"font-medium text-primary underline-offset-4 hover:underline\"\n            >\n              Sign in now\n            </Link>\n          </div>\n        </div>\n      </AuthCard>\n    )\n  }\n\n  return (\n    <AuthCard\n      title=\"Reset password\"\n      description=\"Enter your new password below\"\n    >\n      <AuthForm\n        schema={resetPasswordSchema}\n        defaultValues={{\n          password: '',\n          confirmPassword: '',\n        }}\n        onSubmit={(data) => resetPasswordMutation.mutate(data)}\n        submitText=\"Reset password\"\n        loadingText=\"Resetting...\"\n        isLoading={resetPasswordMutation.isPending}\n        form={form}\n      >\n        {(form) => (\n          <>\n            <AuthField\n              control={form.control}\n              name=\"password\"\n              label=\"New Password\"\n              placeholder=\"Enter your new password\"\n              type=\"password\"\n            />\n\n            <AuthField\n              control={form.control}\n              name=\"confirmPassword\"\n              label=\"Confirm Password\"\n              placeholder=\"Confirm your new password\"\n              type=\"password\"\n            />\n          </>\n        )}\n      </AuthForm>\n\n      <div className=\"text-center text-sm text-muted-foreground mt-4 space-x-1\">\n        <div className=\"inline-block\">Remember your password? </div>\n        <div className=\"inline-block\">\n          <Link\n            to=\"/sign-in\"\n            className=\"font-medium text-primary underline-offset-4 hover:underline\"\n          >\n            Sign in\n          </Link>\n        </div>\n      </div>\n    </AuthCard>\n  )\n}\n"],"mappings":"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"}